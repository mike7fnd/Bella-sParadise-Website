<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bella’s Paradise – Book Your Experience</title>
  <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@100;200;300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
{{>head}}
  <style>
    :root {
      --accent: #d81b60;
      --bg: #f8f9fc;
      --text: #1a1a1a;
      --muted: #666666;
      --shadow: 0 8px 32px rgba(0,0,0,0.08);
      --max-width: 1480px;
    }

    *, *::before, *::after { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: "Archivo", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
    }

    .container {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 0 20px;
    }

   .page-title {
  font-size: 2.3rem;
  text-align: center;
  margin: 8rem 0 1rem; /* increased top margin from 4rem to 6rem */
  font-weight: 350;
  /* Alternatively, you can use pading-top instead of increasing margin */
  /* padding-top: 2rem; */
}

.page-subtitle {
  text-align: center;
  color: var(--muted);
  font-size: 1.1rem;
  max-width: 720px;
  margin: 0 auto 5rem;
}


/* ============================
   SEARCH SECTION (Airbnb-style)
=============================== */

.search-section {
  margin-bottom: 3rem;
}

.search-bar {
  background: white;
  border-radius: 50px;
  box-shadow: 0 8px 28px rgba(0,0,0,0.08);
  padding: 14px 22px;
  display: flex;
  align-items: center;
  gap: 18px;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  max-width: 900px;
  margin: 0 auto;
}

.search-icon svg {
  width: 26px;
  height: 26px;
  stroke: var(--text);
  fill: none;
  stroke-width: 2;
  opacity: 0.7;
}

#search-input {
  flex: 1;
  border: none;
  font-size: 1.1rem;
  background: transparent;
  outline: none;
}

.filters {
  display: flex;
  gap: 12px;
}

.filters select {
  padding: 10px 16px;
  border-radius: 40px;
  border: 1px solid #ddd;
  background: #fafafa;
  font-size: 0.95rem;
  cursor: pointer;
}

/* Mobile adjustments */
@media (max-width: 700px) {
  .search-bar {
    flex-direction: column;
    gap: 14px;
    padding: 18px 22px;
    border-radius: 28px;
  }
  .filters {
    width: 100%;
  }
  .filters select {
    flex: 1;
  }
  #search-input {
    width: 100%;
  }
}



    /* 4 → 2 → 1 GRID */
   .facilities-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* CHANGED from 4 → 3 */
  gap: 20px;
  margin-bottom: 6rem;
}

@media (max-width: 1100px) {
  .facilities-grid {
    grid-template-columns: repeat(2, 1fr); /* stays 2-column on tablets */
  }
}

@media (max-width: 640px) {
  .facilities-grid {
    grid-template-columns: 1fr;  /* full width on mobile */
    gap: 10px;
  }
  .container {
    padding: 0 16px;
  }
}


    /* CARD */
.card {
  position: relative;
  aspect-ratio: 4 / 3;
  background: var(--img) center/cover no-repeat;
  border-radius: 32px;
  overflow: hidden;
  box-shadow: 0 8px 24px rgba(0,0,0,0.18);
  cursor: pointer;
  transition: all 0.25s ease;
  display: flex;
  align-items: flex-end;
}

/* Bottom-to-top fade like second UI */
.card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to top,
    rgba(0, 0, 0, 0.72) 0%,
    rgba(0, 0, 0, 0.38) 25%,
    rgba(0, 0, 0, 0.12) 55%,
    transparent 100%
  );
  z-index: 1;
}

.card > * {
  position: relative;
  z-index: 2;
}

/* TITLE (updated visually like second UI) */
.card-title {
  position: absolute;
  bottom: 62px;
  left: 20px;
  font-size: 1.65rem;
  font-weight: 300;
  color: white;
  margin: 0;
  line-height: 1;
  text-shadow: 0 2px 10px rgba(0,0,0,0.8);
  transition: bottom 0.35s ease;
  pointer-events: none;
}

/* BLURRED TAG — updated to match second UI */
.info-tag {
  position: absolute;
  bottom: 18px;
  left: 18px;

  background: rgba(255, 255, 255, 0.06);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);

  border-radius: 50px;
  padding: 9px 17px;

  display: flex;
  align-items: center;
  gap: 14px;

  font-size: 0.9rem;
  font-weight: 200;
  color: white;

  transition: all 0.3s ease;
}

.price {
  font-weight: 500;
  color: #cf7e99;
}

/* HEART — styled to match second UI’s proportion + behavior */
.heart {
  position: absolute;
  top: 18px;
  right: 18px;

  width: 56px;
  height: 56px;

  display: flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;
  border-radius: 50%;

  z-index: 10;
  transition: all 0.3s ease;
}

.heart:hover {
  transform: scale(1.12);
  background: rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}

.heart svg {
  width: 32px;
  height: 32px;
  fill: none;
  stroke: white;
  stroke-width: 2.3;
  transition: all 0.3s ease;
}

.heart.liked svg {
  fill: white;
  stroke: white;
  animation: bounce 0.6s ease;
}

@keyframes bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.5); }
}


    /* MODALS */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(16px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    .modal.active { display: flex; }

    .modal-content {
      background: white;
      border-radius: 32px;
      max-width: 820px;
      width: 100%;
      max-height: 95vh;
      overflow: hidden;
      box-shadow: 0 30px 80px rgba(0,0,0,0.2);
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 16px; right: 16px;
      width: 44px; height: 44px;
      background: rgba(0,0,0,0.1);
      border: none;
      border-radius: 50%;
      font-size: 1.6rem;
      cursor: pointer;
      z-index: 10;
    }

    .modal-img {
      height: 320px;
      background: center/cover no-repeat;
    }

    .modal-body{
      padding: 2.5rem;
    }

    .modal-title {
      font-size: 2.2rem;
       margin-bottom: 0.5rem;
    }

    .modal-meta {
       color: var(--muted);
        font-size: 1.1rem;
      }

    .modal-price {
      font-size: 2rem;
       font-weight: 400;
       color: #ff7ea9;
       margin: 1.5rem 0;
    }

    .modal-book {
      background: var(--accent);
      color: white;
      border: none;
      padding: 1rem 2.5rem;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
    }
    /* SUCCESS MODAL */
#success-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(3px);
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

#success-modal.active {
  display: flex;
}

.success-box {
  background: #fff;
  padding: 40px 50px;
  border-radius: 20px;
  text-align: center;
  animation: popIn 0.35s ease-out;
  box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

@keyframes popIn {
  0% { transform: scale(0.6); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

/* SVG CHECK ANIMATION */
.checkmark {
  width: 80px;
  height: 80px;
  stroke-width: 4;
  stroke: #4caf50;
  fill: none;
  stroke-linecap: round;
  margin-bottom: 15px;
}

.checkmark-circle {
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  animation: circle 0.6s ease-out forwards;
}

.checkmark-check {
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: check 0.35s 0.6s ease forwards;
}

@keyframes circle {
  to { stroke-dashoffset: 0; }
}

@keyframes check {
  to { stroke-dashoffset: 0; }
}


  </style>

</head>


<body>


  <div class="container">
    <h1 class="page-title">Book Your Experience</h1>
    <p class="page-subtitle">Explore our resort offerings, pool, kubos, cabanas, house, and more for your perfect day or overnight stay.</p>

    <!-- SEARCH + FILTER BAR (Airbnb-style) -->
<section class="search-section">
  <div class="search-bar">
    <div class="search-icon">
      <svg viewBox="0 0 24 24">
        <path d="M10 2a8 8 0 105.293 14.293l4.707 4.707 1.414-1.414-4.707-4.707A8 8 0 0010 2zm0 2a6 6 0 110 12A6 6 0 0110 4z"/>
      </svg>
    </div>

    <input id="search-input" type="text" placeholder="Search facilities...">

    <div class="filters">
      <select id="filter-type">
        <option value="">All Types</option>
        <option value="Kubo">Kubo</option>
        <option value="Cabana">Cabana</option>
        <option value="Room">Room</option>
        <option value="Hall">Function Hall</option>
        <option value="House">House</option>
      </select>

      <select id="filter-capacity">
        <option value="">Capacity</option>
        <option value="10">Up to 10 pax</option>
        <option value="20">Up to 20 pax</option>
        <option value="50">Up to 50 pax</option>
        <option value="100">Up to 100 pax</option>
      </select>
    </div>
  </div>
</section>


    <div class="facilities-grid" id="grid"></div>
  </div>

  <!-- SEARCH + FILTER SECTION -->


  <!-- Facility Modal -->
  <div id="facility-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close">×</button>
      <div class="modal-img" id="f-img"></div>
      <div class="modal-body">
        <h3 id="f-title" class="modal-title"></h3>
        <div id="f-meta" class="modal-meta"></div>
        <p id="f-desc">No description available.</p>
        <div class="modal-price" id="f-price"></div>
        <button id="f-book" class="modal-book">Book / Inquire</button>
      </div>
    </div>
  </div>
  <!-- Success Animation Modal -->
<div id="success-modal" class="modal">
  <div class="success-box">
    <svg class="checkmark" viewBox="0 0 52 52">
      <circle class="checkmark-circle" cx="26" cy="26" r="25" />
      <path class="checkmark-check" fill="none" d="M14 27l7 7 16-16"/>
    </svg>
    <h3>Booking Successful!</h3>
    <p>Your request has been submitted.</p>
  </div>
</div>


  <!-- Booking Modal -->
  <div id="booking-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close">×</button>
      <div class="modal-body">
        <h3 class="modal-title" style="text-align:center;margin-bottom:1.5rem;">Complete Your Reservation</h3>
        <form id="booking-form" style="display:grid;gap:1.5rem;">
          <input id="bf-name" type="text" readonly style="padding:1rem;border-radius:12px;background:#f8f8f8;border:1px solid #ddd;font-weight:500;">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
            <input id="bf-in" type="date" required>
            <input id="bf-out" type="date" required>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
            <input id="bf-guests" type="number" min="1" value="1" required placeholder="Guests">
            <input id="bf-phone" type="tel" placeholder="Phone">
          </div>
          <textarea id="bf-notes" rows="4" placeholder="Special requests (optional)..."></textarea>
          <div style="background:#f9f9f9;padding:1.5rem;border-radius:16px;text-align:center;">
            <div style="font-size:1.8rem;font-weight:700;color:var(--accent);" id="bf-price">—</div>
            <div style="margin-top:1rem;display:flex;gap:1rem;justify-content:center;">
              <button type="button" class="modal-close" style="padding:0.9rem 2rem;border-radius:50px;background:#ddd;">Cancel</button>
              <button type="submit" style="padding:0.9rem 2.5rem;border-radius:50px;background:var(--accent);color:white;font-weight:700;">Confirm Booking</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

 <script>
/* -------------------------------------------------------------
   FACILITIES (dynamic load, polling, caching)
------------------------------------------------------------- */
/* SEARCH + FILTER HANDLING */
const searchInput = document.getElementById('search-input');
const filterType = document.getElementById('filter-type');
const filterCapacity = document.getElementById('filter-capacity');

function applyFilters() {
  const text = searchInput.value.toLowerCase();
  const type = filterType.value;
  const cap = filterCapacity.value;

  const filtered = facilities.filter(f => {
    const matchesText =
      f.name.toLowerCase().includes(text) ||
      (f.type && f.type.toLowerCase().includes(text));

    const matchesType = type ? f.type === type : true;
    const matchesCap = cap ? f.capacity <= Number(cap) : true;

    return matchesText && matchesType && matchesCap;
  });

  grid.innerHTML = "";
  filtered.forEach(renderCard);
}

searchInput.addEventListener('input', applyFilters);
filterType.addEventListener('change', applyFilters);
filterCapacity.addEventListener('change', applyFilters);


let facilities = [];
const grid = document.getElementById('grid');

// Placeholder images by type
function getPlaceholder(type) {
  const map = {
    Kubo: 'https://via.placeholder.com/800x450?text=Kubo',
    Cabana: 'https://via.placeholder.com/800x450?text=Cabana',
    Room: 'https://via.placeholder.com/800x450?text=Room',
    Hall: 'https://via.placeholder.com/800x450?text=Function+Hall',
    House: 'https://via.placeholder.com/800x450?text=House'
  };
  return map[type] || 'https://via.placeholder.com/800x450?text=Facility';
}

function renderFacilities() {
  grid.innerHTML = '';

  facilities.forEach(f => {
    const price = f.price == 0 ? 'FREE' : `₱${Number(f.price).toLocaleString()}`;
    const img = f.imageUrl || getPlaceholder(f.type);

    const card = document.createElement('div');
    card.className = 'card';
    card.style.setProperty('--img', `url(${img})`);

    card.innerHTML = `
      <div class="heart">
        <svg viewBox="0 0 24 24">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
          2 5.42 4.42 3 7.5 3c1.74 0 3.41.81
          4.5 2.09C13.09 3.81 14.76 3
          16.5 3 19.58 3 22 5.42 22
          8.5c0 3.78-3.4 6.86-8.55
          11.54L12 21.35z"/>
        </svg>
      </div>
      <h2 class="card-title">${f.name}</h2>
      <div class="info-tag">
        <span>${f.capacity} pax</span>
        <span class="price">${price}</span>
      </div>
    `;

    // Like toggle
    card.querySelector('.heart').addEventListener('click', e => {
      e.stopPropagation();
      e.currentTarget.classList.toggle('liked');
    });

    card.addEventListener('click', () => openFacilityModal(f));
    grid.appendChild(card);
  });
}

async function loadFacilities() {
  try {
    const res = await fetch('/api/facilities');
    facilities = await res.json();
    renderFacilities();
  } catch (err) {
    grid.innerHTML =
      '<p style="grid-column:1/-1;text-align:center;padding:80px;color:#888;">Unable to load facilities.</p>';
  }
}

// initial load
loadFacilities();

// poll every 15 seconds (from your first file)
setInterval(loadFacilities, 15000);


/* -------------------------------------------------------------
   FACILITY MODAL
------------------------------------------------------------- */

function openFacilityModal(f) {
  const img = document.getElementById('f-img');
  const title = document.getElementById('f-title');
  const meta = document.getElementById('f-meta');
  const desc = document.getElementById('f-desc');
  const price = document.getElementById('f-price');

  img.style.backgroundImage = `url(${f.imageUrl || getPlaceholder(f.type)})`;
  title.textContent = f.name;
  meta.textContent = `${f.type} • ${f.capacity} pax`;
  desc.textContent = f.description || 'No description available.';
  price.textContent = f.price == 0 ? 'FREE' : `₱${Number(f.price).toLocaleString()}`;

  document.getElementById('f-book').onclick = () => openBookingModal(f);

  document.getElementById('facility-modal').classList.add('active');
}


/* -------------------------------------------------------------
   BOOKING MODAL + FORM HANDLING (full DB logic)
------------------------------------------------------------- */

function openBookingModal(facility) {
  document.getElementById('booking-modal').classList.add('active');
  document.getElementById('bf-name').value = facility.name;

  // Price preview
  document.getElementById('bf-price').textContent =
    facility.price == 0 ? 'FREE' : `₱${Number(facility.price).toLocaleString()}`;

  // Save facility ID to form
  const form = document.getElementById('booking-form');
  form.dataset.facilityId = facility.id;

  // Prefill phone from profile (from your first file)
  fetch('/api/profile')
    .then(r => r.json())
    .then(p => {
      if (p && p.mobile) document.getElementById('bf-phone').value = p.mobile;
    })
    .catch(() => {});
}

// Validation (same logic as first file)
function validateBooking() {
  const checkIn = document.getElementById('bf-in').value;
  const checkOut = document.getElementById('bf-out').value;
  const guests = parseInt(document.getElementById('bf-guests').value || 0);

  if (!checkIn || !checkOut) return false;

  const d1 = new Date(checkIn);
  const d2 = new Date(checkOut);
  if (isNaN(d1) || isNaN(d2) || d2 <= d1) return false;

  if (guests < 1) return false;

  return true;
}

['bf-in', 'bf-out', 'bf-guests'].forEach(id => {
  const el = document.getElementById(id);
  if (el) el.addEventListener('input', validateBooking);
});

// Submit booking (full DB POST from first file)
document.getElementById('booking-form').addEventListener('submit', async e => {
  e.preventDefault();

  if (!validateBooking()) {
    alert('Please provide valid dates and guest count.');
    return;
  }

  const form = e.target;
  const facilityId = Number(form.dataset.facilityId);

  const payload = {
    facilityId,
    check_in: document.getElementById('bf-in').value,
    check_out: document.getElementById('bf-out').value,
    guests: Number(document.getElementById('bf-guests').value),
    contact_phone: document.getElementById('bf-phone').value,
    notes: document.getElementById('bf-notes').value
  };

  try {
    const res = await fetch('/api/bookings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

  if (res.status === 201) {
    closeAllModals();
    showSuccessAnimation();  // <-- NEW ANIMATED FEEDBACK
}
 else if (res.status === 401) {
      window.location = '/login';
    } else {
      const data = await res.json().catch(() => ({}));
      alert('Booking error: ' + (data.error || data.message || res.status));
    }
  } catch (err) {
    alert('Network error while submitting booking.');
  }
});


/* -------------------------------------------------------------
   CLOSE MODALS
------------------------------------------------------------- */

function closeAllModals() {
  document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
}

document.addEventListener('click', e => {
  if (e.target.classList.contains('modal') || e.target.classList.contains('modal-close')) {
    closeAllModals();
  }
});
function showSuccessAnimation() {
  const m = document.getElementById('success-modal');
  m.classList.add('active');

  // Auto-close after animation
  setTimeout(() => {
    m.classList.remove('active');
  }, 2200);
}



</script>


</body>
</html>
{{>footer}}
